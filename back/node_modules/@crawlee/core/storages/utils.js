"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useState = exports.purgeDefaultStorages = void 0;
const key_value_store_1 = require("./key_value_store");
const configuration_1 = require("../configuration");
async function purgeDefaultStorages(configOrOptions, client) {
    const options = configOrOptions instanceof configuration_1.Configuration ? {
        client,
        config: configOrOptions,
    } : configOrOptions ?? {};
    const { config = configuration_1.Configuration.getGlobalConfig(), onlyPurgeOnce = false, } = options;
    ({ client = config.getStorageClient() } = options);
    const casted = client;
    // if `onlyPurgeOnce` is true, will purge anytime this function is called, otherwise - only on start
    if (!onlyPurgeOnce || (config.get('purgeOnStart') && !casted.__purged)) {
        casted.__purged = true;
        await casted.purge?.();
    }
}
exports.purgeDefaultStorages = purgeDefaultStorages;
/**
 * Easily create and manage state values. All state values are automatically persisted.
 *
 * Values can be modified by simply using the assignment operator.
 *
 * @param name The name of the store to use.
 * @param defaultValue If the store does not yet have a value in it, the value will be initialized with the `defaultValue` you provide.
 * @param options An optional object parameter where a custom `keyValueStoreName` and `config` can be passed in.
 */
async function useState(name, defaultValue = {}, options) {
    const kvStore = await key_value_store_1.KeyValueStore.open(options?.keyValueStoreName, { config: options?.config || configuration_1.Configuration.getGlobalConfig() });
    return kvStore.getAutoSavedValue(name || 'CRAWLEE_GLOBAL_STATE', defaultValue);
}
exports.useState = useState;
//# sourceMappingURL=utils.js.map